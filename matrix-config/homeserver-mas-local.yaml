server_name: "${SYNAPSE_SERVER_NAME}"
public_baseurl: "http://localhost:8448"
pid_file: /data/homeserver.pid
web_client_location: "http://localhost:9005"

listeners:
  - port: 8448
    tls: false
    type: http
    x_forwarded: true
    bind_addresses: ['0.0.0.0']
    resources:
      - names: [client, federation, metrics]
        compress: false

database:
  name: psycopg2
  args:
    user: "${POSTGRES_USER}"
    password: "${POSTGRES_PASSWORD}"
    database: "synapse"
    host: "${POSTGRES_HOST}"
    port: "5432"
    cp_min: 5
    cp_max: 10
  allow_unsafe_locale: true

# MSC3861 - Delegate authentication to MAS
experimental_features:
  msc3861:
    enabled: true
    issuer: "${MAS_ISSUER}"
    client_id: "0000000000000000000SYNAPSE"
    client_auth_method: "client_secret_basic"
    client_secret: "${MAS_CLIENT_SECRET}"
    admin_token: "local-mas-admin-token"

# Disable built-in authentication since MAS handles it
password_providers: []
enable_registration: false
registration_shared_secret: null

# Remove OIDC providers - MAS handles this now
oidc_providers: []

# Existing configuration
macaroon_secret_key: "your-secret-key-here"
form_secret: "your-form-secret-here"
signing_key_path: "/data/signing.key"

media_store_path: /data/media
uploads_path: /data/uploads
data_dir: /data

log_config: "/data/log.config"

federation_domain_whitelist: []
federation_ip_range_blacklist:
  - '127.0.0.0/8'
  - '10.0.0.0/8'
  - '192.168.0.0/16'

enable_metrics: true
report_stats: false

app_service_config_files: []

user_directory:
  enabled: true
  search_all_users: false
  prefer_local_users: true

# Room and user limits
max_upload_size: "50M"
url_preview_enabled: false